<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Mecatronics Leaderboard - RMSE</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-900 text-white p-10">
    <div class="max-w-5xl mx-auto">
        <header class="text-center mb-10">
            <h1 class="text-5xl font-extrabold text-blue-400">Mobile Robot Control Ranking</h1>
            <p class="text-slate-400 mt-4 text-xl">Real-time RMSE Assessment (Lower is Better)</p>
        </header>
<div class="mb-10 bg-slate-800 p-5 rounded-2xl shadow-xl">
    <h2 class="text-2xl font-bold text-blue-300 mb-4 text-center">Latest Submission Performance</h2>
    <img id="latest-plot" src="latest_plot.png" alt="Latest Submission Plot" class="w-full rounded-lg border border-slate-600">
</div>
        <div class="bg-slate-800 rounded-2xl shadow-2xl overflow-hidden">
            <table class="w-full text-left">
                <thead class="bg-slate-700 text-slate-200">
                    <tr>
                        <th class="p-5">Rank</th>
                        <th class="p-5">Student Name</th>
                        <th class="p-5">RMSE Score</th>
                        <th class="p-5">Grade</th>
                    </tr>
                </thead>
                <tbody id="leaderboard">
                    </tbody>
            </table>
        </div>
    </div>

<script>
        async function updateLeaderboard() {
            try {
                // 1. Fetch the CSV file from the repository
                const response = await fetch('results.csv');
                if (!response.ok) throw new Error('CSV not found');
                
                const csvText = await response.text();
                
                // 2. Parse CSV rows and skip the header
                const rows = csvText.trim().split('\n').slice(1);
                
                // 3. Map data into an array of objects
                let data = rows.map(row => {
                    const cols = row.split(',');
                    return { 
                        name: cols[0], 
                        rmse: parseFloat(cols[1]), 
                        grade: cols[2] 
                    };
                });

                // 4. Sort by lowest RMSE (Best performance first)
                data.sort((a, b) => a.rmse - b.rmse);

                // 5. Update the Table
                const container = document.getElementById('leaderboard');
                container.innerHTML = data.map((item, index) => {
                    let rankDisplay = index + 1;
                    let rowClass = "border-b border-slate-700 hover:bg-slate-700/50 transition";
                    
                    // Special styling for top 3
                    if (index === 0) { rankDisplay = 'ðŸ¥‡'; rowClass = "bg-yellow-900/20 border-b border-yellow-700"; }
                    else if (index === 1) { rankDisplay = 'ðŸ¥ˆ'; }
                    else if (index === 2) { rankDisplay = 'ðŸ¥‰'; }

                    return `
                        <tr class="${rowClass}">
                            <td class="p-5 font-bold text-2xl text-center">${rankDisplay}</td>
                            <td class="p-5 font-semibold text-blue-300 text-lg">${item.name}</td>
                            <td class="p-5 font-mono text-yellow-400">${item.rmse.toFixed(4)}</td>
                            <td class="p-5 font-bold text-green-400 text-xl">${item.grade}</td>
                        </tr>
                    `;
                }).join('');

                // 6. Force Refresh of the Plot Image (Bypass Cache)
                const plotImage = document.getElementById('latest-plot');
                if (plotImage) {
                    plotImage.src = "latest_plot.png?v=" + new Date().getTime();
                }

                console.log("Leaderboard and Plot updated successfully.");

            } catch (error) {
                console.error("Error updating leaderboard:", error);
            }
        }

        // Initial load
        updateLeaderboard();

        // Refresh every 20 seconds to show live competition results
        setInterval(updateLeaderboard, 20000);
    </script>
</body>
</html>
